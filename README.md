# Сервис назначения ревьюеров PR

Микросервис на Go для автоматического назначения ревьюеров на Pull Request'ы, управления командами и пользователями.

## Стек

*   **Язык:** Go
*   **База данных:** PostgreSQL
*   **Оркестрация:** Docker, Docker Compose
*   **Роутинг:** `chi`
*   **Миграции:** `golang-migrate`
*   **Авторизация:** JWT
*   **Документация:** OpenAPI 3.0 (интерфейс Swagger UI)

## Запуск проекта

### 1. Предварительные требования
*   Установленный Docker и Docker Compose.

### 2. Конфигурация

Все необходимые для запуска переменные окружения находятся в файле `.env`. Вы можете изменить их при необходимости. Файл `.env.example` содержит шаблон.

### 3. Запуск

Выполните команду в корне проекта:
```bash
docker compose up --build
```
*   Флаг `--build` необходим при первом запуске или после внесения изменений в код.
*   Сервис будет доступен по адресу `http://localhost:8080`.

## API и Документация

Интерактивная документация API (Swagger UI) доступна после запуска по адресу:
*   **[http://localhost:8080/docs/](http://localhost:8080/docs/)**

Для проверки работоспособности сервиса и подключения к БД можно использовать эндпоинт:
*   `GET /health`

## Авторизация

Все эндпоинты, кроме `/login`, `/docs/*` и `/health`, требуют авторизации по JWT.

**1. Получение токена**

Отправьте POST-запрос на `/login`. В текущей реализации тело запроса не требуется.
```bash
curl -X POST http://localhost:8080/login
```

В ответ вы получите токен:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

**2. Использование токена**

Используйте полученный токен в заголовке `Authorization: Bearer <ваш_токен>` для всех защищенных эндпоинтов.

В интерфейсе Swagger UI для этого нужно нажать на кнопку **"Authorize"** в правом верхнем углу и вставить токен в соответствующее поле.

## Тестирование

Для запуска всех тестов (unit и интеграционных) выполните команду в корне проекта:
```bash
go test ./...
```

Для просмотра покрытия кода тестами:
```bash
go test -cover ./...
```

## Реализованные дополнительные задания

*   **Эндпоинт статистики**: Добавлен маршрут `GET /stats/user` для получения количества ревью по пользователям.
*   **Интеграционное/E2E-тестирование**: Реализовано на уровне `handler` с использованием `testcontainers` для полной изоляции тестовой базы данных.